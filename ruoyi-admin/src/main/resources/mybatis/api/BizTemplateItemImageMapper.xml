<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.api.mapper.BizTemplateItemImageMapper">
    
    <resultMap type="com.ruoyi.api.domain.BizTemplateItemImage" id="BizTemplateItemImageResult">
        <id     property="imageId"          column="image_id"           />
        <result property="templateItemId"   column="template_item_id"   />
        <result property="imageUrl"         column="image_url"          />
        <result property="imageName"        column="image_name"         />
        <result property="imageType"        column="image_type"         />
        <result property="imageSize"        column="image_size"         />
        <result property="sortOrder"        column="sort_order"         />
        <result property="delFlag"          column="del_flag"           />
        <result property="createBy"         column="create_by"          />
        <result property="createTime"       column="create_time"        />
        <result property="updateBy"         column="update_by"          />
        <result property="updateTime"       column="update_time"        />
    </resultMap>

    <sql id="selectBizTemplateItemImageVo">
        select image_id, template_item_id, image_url, image_name, image_type, image_size, 
               sort_order, del_flag, create_by, create_time, update_by, update_time 
        from biz_template_item_image
    </sql>

    <select id="selectBizTemplateItemImageById" parameterType="Long" resultMap="BizTemplateItemImageResult">
        <include refid="selectBizTemplateItemImageVo"/>
        where image_id = #{imageId} and del_flag = '0'
    </select>

    <select id="selectBizTemplateItemImageByItemId" parameterType="Long" resultMap="BizTemplateItemImageResult">
        <include refid="selectBizTemplateItemImageVo"/>
        where template_item_id = #{templateItemId} and del_flag = '0'
        order by sort_order asc
    </select>

    <select id="selectBizTemplateItemImageList" parameterType="com.ruoyi.api.domain.BizTemplateItemImage" resultMap="BizTemplateItemImageResult">
        <include refid="selectBizTemplateItemImageVo"/>
        <where>
            del_flag = '0'
            <if test="templateItemId != null">
                AND template_item_id = #{templateItemId}
            </if>
            <if test="imageName != null and imageName != ''">
                AND image_name like concat('%', #{imageName}, '%')
            </if>
            <if test="imageType != null and imageType != ''">
                AND image_type = #{imageType}
            </if>
        </where>
        order by sort_order asc
    </select>

    <insert id="insertBizTemplateItemImage" parameterType="com.ruoyi.api.domain.BizTemplateItemImage" useGeneratedKeys="true" keyProperty="imageId">
        insert into biz_template_item_image
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="templateItemId != null">template_item_id,</if>
            <if test="imageUrl != null and imageUrl != ''">image_url,</if>
            <if test="imageName != null">image_name,</if>
            <if test="imageType != null">image_type,</if>
            <if test="imageSize != null">image_size,</if>
            <if test="sortOrder != null">sort_order,</if>
            <if test="delFlag != null">del_flag,</if>
            <if test="createBy != null">create_by,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateBy != null">update_by,</if>
            <if test="updateTime != null">update_time,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="templateItemId != null">#{templateItemId},</if>
            <if test="imageUrl != null and imageUrl != ''">#{imageUrl},</if>
            <if test="imageName != null">#{imageName},</if>
            <if test="imageType != null">#{imageType},</if>
            <if test="imageSize != null">#{imageSize},</if>
            <if test="sortOrder != null">#{sortOrder},</if>
            <if test="delFlag != null">#{delFlag},</if>
            <if test="createBy != null">#{createBy},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateBy != null">#{updateBy},</if>
            <if test="updateTime != null">#{updateTime},</if>
        </trim>
    </insert>

    <insert id="batchInsertBizTemplateItemImage" parameterType="java.util.List">
        insert into biz_template_item_image (
            template_item_id, image_url, image_name, image_type, image_size, 
            sort_order, del_flag, create_by, create_time
        ) values
        <foreach item="item" index="index" collection="list" separator=",">
            (
                #{item.templateItemId},
                #{item.imageUrl},
                #{item.imageName},
                #{item.imageType},
                #{item.imageSize},
                #{item.sortOrder},
                '0',
                #{item.createBy},
                #{item.createTime}
            )
        </foreach>
    </insert>

    <update id="updateBizTemplateItemImage" parameterType="com.ruoyi.api.domain.BizTemplateItemImage">
        update biz_template_item_image
        <trim prefix="SET" suffixOverrides=",">
            <if test="imageUrl != null and imageUrl != ''">image_url = #{imageUrl},</if>
            <if test="imageName != null">image_name = #{imageName},</if>
            <if test="imageType != null">image_type = #{imageType},</if>
            <if test="imageSize != null">image_size = #{imageSize},</if>
            <if test="sortOrder != null">sort_order = #{sortOrder},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
        </trim>
        where image_id = #{imageId}
    </update>

    <update id="deleteBizTemplateItemImageById" parameterType="Long">
        update biz_template_item_image set del_flag = '2' where image_id = #{imageId}
    </update>

    <update id="deleteBizTemplateItemImageByIds" parameterType="String">
        update biz_template_item_image set del_flag = '2' where image_id in 
        <foreach item="imageId" collection="array" open="(" separator="," close=")">
            #{imageId}
        </foreach>
    </update>

    <update id="deleteBizTemplateItemImageByItemId" parameterType="Long">
        update biz_template_item_image set del_flag = '2' where template_item_id = #{templateItemId}
    </update>

    <select id="getMaxSortOrderByItemId" parameterType="Long" resultType="Integer">
        select max(sort_order) from biz_template_item_image 
        where template_item_id = #{templateItemId} and del_flag = '0'
    </select>

</mapper>
